!function(){"use strict";var e={8027:function(e,t,i){i.d(t,{q:function(){return n}});var r=i(4685),s=i(4067);class n{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.initialized=!1,this.$form=e.$form,this.form=this.$form.form,this.$field=e.$field,this.successClass=this.form.getClasses("success"),this.successMessageClass=this.form.getClasses("successMessage"),this.errorClass=this.form.getClasses("error"),this.errorMessageClass=this.form.getClasses("errorMessage"),this.isVisible=!1;const t=new IntersectionObserver((e=>{0==e[0].intersectionRatio?(this.isVisible=!1,this.initialized&&this.onHide()):(this.isVisible=!0,this.initialized&&this.onShow())}),{root:this.$form,rootMargin:"50px"});setTimeout((()=>{t.observe(this.$field)}),500)}eventKey(e,t){return(0,r.kK)(e,`${t}-${this.$field.getAttribute("data-field-handle")}`)}removeSuccess(){(0,r.GK)(this.$field,this.successClass);const e=this.$field.querySelector("[data-payment-success]");e&&e.remove()}addSuccess(e){(0,r.PT)(this.$field,this.successClass);const t=this.$field.querySelector("[data-field-type] > div");if(!t)return console.error("Unable to find `[data-field-type] > div` to add success message.");const i=document.createElement("div");i.textContent=e,i.setAttribute("data-payment-success",""),(0,r.PT)(i,this.successMessageClass),t.appendChild(i)}removeError(){(0,r.GK)(this.$field,this.errorClass);const e=this.$field.querySelector("[data-payment-error]");e&&e.remove()}addError(e){(0,r.PT)(this.$field,this.errorClass);const t=this.$field.querySelector("[data-field-type] > div");if(!t)return console.error("Unable to find `[data-field-type] > div` to add error message.");const i=document.createElement("div");i.textContent=e,i.setAttribute("data-payment-error",""),(0,r.PT)(i,this.errorMessageClass),t.appendChild(i),this.submitHandler&&this.submitHandler.formSubmitError()}updateInputs(e,t){const i=this.$field.querySelector(`[name*="${e}"]`);i&&(i.value=t)}getBillingData(){if(!this.billingDetails)return{};const e={};if(this.billingDetails.billingName){const t=this.getFieldValue(this.billingDetails.billingName);t&&(e.name=t)}if(this.billingDetails.billingEmail){const t=this.getFieldValue(this.billingDetails.billingEmail);t&&(e.email=t)}if(this.billingDetails.billingAddress){e.address={};const t=this.getFieldValue(`${this.billingDetails.billingAddress}[address1]`),i=this.getFieldValue(`${this.billingDetails.billingAddress}[address2]`),r=this.getFieldValue(`${this.billingDetails.billingAddress}[address3]`),s=this.getFieldValue(`${this.billingDetails.billingAddress}[city]`),n=this.getFieldValue(`${this.billingDetails.billingAddress}[zip]`),o=this.getFieldValue(`${this.billingDetails.billingAddress}[state]`),l=this.getFieldValue(`${this.billingDetails.billingAddress}[country]`);t&&(e.address.line1=t),i&&(e.address.line2=i),r&&(e.address.line3=r),s&&(e.address.city=s),n&&(e.address.postal_code=n),o&&(e.address.state=o),l&&(e.address.country=l)}new CustomEvent("modifyBillingDetails",{bubbles:!0,detail:{provider:this,billing:e}});return{billing_details:e}}getFieldValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"string";const i=(0,s.oe)(this.$form,e);return"float"===t||"int"===t||"number"===t?(0,r.Bp)(i):i}getFieldLabel(e){return(0,s.N3)(this.$form,e)}onShow(){}onHide(){}processResubmit(){this.form.config.Formie.refreshFormTokens(this.form),this.submitHandler?this.submitHandler.processSubmit(["payment"]):this.form&&this.form.processSubmit(["payment"])}}window.FormiePaymentProvider=n},4067:function(e,t,i){i.d(t,{N3:function(){return n},Ts:function(){return s},oe:function(){return o}});const r=function(e,t){let i=e.querySelectorAll(`[name="${t}"]`);const r=e.querySelectorAll(`[name="${t}[]"]`);return r.length&&(i=r),i},s=function(e){return`fields[${e=e.replace("{field:","").replace("{","").replace("}","").replace("]","").split("[").join("][")}]`},n=function(e,t){let i="";t=s(t);const n=r(e,t);return n&&n.forEach((e=>{const t=e.closest("[data-field-type]");if(t){const e=t.querySelector("[data-field-label]");e&&(i=e.childNodes[0].textContent?.trim()??"")}})),i},o=function(e,t){let i="";t=s(t);const n=r(e,t);return n&&n.forEach((e=>"checkbox"!==e.type&&"radio"!==e.type||e.checked?i=e.value:void 0)),i}},4685:function(e,t,i){i.d(t,{Bp:function(){return h},Ds:function(){return l},GK:function(){return d},Iw:function(){return o},PT:function(){return a},d9:function(){return r},kK:function(){return s},t:function(){return n}});const r=function(e){if(void 0!==e)return JSON.parse(JSON.stringify(e))},s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t||(t=Math.random().toString(36).substr(2,5)),`${e}.${t}`},n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return window.FormieTranslations&&(e=window.FormieTranslations[e]||e),e.replace(/{([a-zA-Z0-9]+)}/g,((e,i)=>t[i]?t[i]:e))},o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e5;const i=Date.now(),r=function(s,n){window[e]?s(window[e]):t&&Date.now()-i>=t?n(new Error("timeout")):setTimeout(r.bind(this,s,n),30)};return new Promise(r)},l=function(e,t){let i;return function(){for(var r=arguments.length,s=new Array(r),n=0;n<r;n++)s[n]=arguments[n];clearTimeout(i),i=setTimeout((()=>{e.apply(this,s)}),t)}},a=function(e,t){e&&t&&("string"==typeof t&&(t=t.split(" ")),t.forEach((t=>{e.classList.add(t)})))},d=function(e,t){e&&t&&("string"==typeof t&&(t=t.split(" ")),t.forEach((t=>{e.classList.remove(t)})))},h=function(e){let t=e.replace(/[^\d.,-]/g,"");const i=t.includes(","),r=t.includes(".");return t=i&&r?t.replace(/\./g,"").replace(/,/,"."):i&&!r?t.replace(/,/,"."):t.replace(/,/g,""),parseFloat(t)}}},t={};function i(r){var s=t[r];if(void 0!==s)return s.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,i),n.exports}i.d=function(e,t){for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e=i(4685),t=i(4067),r=i(8027);function s(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function n(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?s(Object(i),!0).forEach((function(t){o(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function o(e,t,i){var r;return(t="symbol"==typeof(r=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?r:String(r))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class l extends r.q{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t),this.$form=t.$form,this.form=this.$form.form,this.$field=t.$field,this.$input=this.$field.querySelector("[data-fui-stripe-elements]"),this.$placeholder=this.$field.querySelector("[data-fui-stripe-elements-placeholder]"),this.$input?(this.boundEvents=!1,this.publishableKey=t.publishableKey,this.paymentType=t.paymentType,this.billingDetails=t.billingDetails||{},this.hidePostalCode=t.hidePostalCode||!1,this.hideIcon=t.hideIcon||!1,this.initialPaymentInformation=t.initialPaymentInformation||{},this.paymentInformation=(0,e.d9)(this.initialPaymentInformation),this.stripeScriptId="FORMIE_STRIPE_SCRIPT",this.publishableKey?this.initialized=!0:console.error("Missing publishable key for Stripe.")):console.error("Unable to find Stripe Elements placeholder for [data-fui-stripe-elements]")}onShow(){this.loadStripe()}onHide(){this.paymentElement&&(this.paymentElement.destroy(),this.paymentElement=null,this.stripe=null,this.boundEvents=!1,this.form.removeEventListener(this.eventKey("onFormiePaymentValidate","stripe")),this.form.removeEventListener(this.eventKey("onAfterFormieSubmit","stripe")),this.form.removeEventListener(this.eventKey("FormiePaymentStripeConfirm","stripe")))}loadStripe(){try{if(document.getElementById(this.stripeScriptId))(0,e.Iw)("Stripe").then((()=>{this.initStripe()}));else{const e=document.createElement("script");e.id=this.stripeScriptId,e.src="https://js.stripe.com/v3",e.async=!0,e.defer=!0,e.onload=()=>{this.initStripe()},document.body.appendChild(e)}this.boundEvents||(this.form.addEventListener(this.$form,this.eventKey("onFormiePaymentValidate","stripe"),this.onValidate.bind(this)),this.form.addEventListener(this.$form,this.eventKey("onAfterFormieSubmit","stripe"),this.onAfterSubmit.bind(this)),this.form.addEventListener(this.$form,this.eventKey("FormiePaymentStripeConfirm","stripe"),this.onValidateConfirm.bind(this)),this.boundEvents=!0)}catch(e){console.error(e),this.showPlaceholder(e,"error")}}initStripe(){if(!this.form.destroyed)try{this.stripe=Stripe(this.publishableKey),this.handleDynamicValues()&&this.renderStripe()}catch(e){console.error(e),this.showPlaceholder(e,"error")}}renderStripe(){try{const t=this.isSubscription()?"subscription":"payment",i={},r=n(n({},this.paymentInformation),{},{capture_method:"automatic",mode:t,appearance:{}}),s=new CustomEvent("beforeInit",{bubbles:!0,detail:{stripe:this,elementOptions:r,paymentOptions:i}});if(this.$field.dispatchEvent(s),!r.amount)return void this.showPlaceholder((0,e.t)("Invalid amount."),"error");if(!r.currency)return void this.showPlaceholder((0,e.t)("Invalid currency."),"error");this.elements=this.stripe.elements(r),this.paymentElement=this.elements.create("payment",i),this.paymentElement.mount(this.$input),this.hidePlaceholder()}catch(e){console.error(e),this.showPlaceholder(e,"error")}}onValidate(e){"submit"!==this.form.submitAction||e.detail.invalid||this.elements&&(e.preventDefault(),this.submitHandler=e.detail.submitHandler,this.removeError(),this.elements.submit().then((e=>{if(e.error)return this.addError(e.error.message);this.submitHandler.submitForm()})))}showPlaceholder(e,t){this.$placeholder.innerHTML=e,this.$placeholder.classList.remove("fui-hidden"),"error"===t&&this.$placeholder.classList.add("fui-error-message")}hidePlaceholder(){this.$placeholder.classList.add("fui-hidden")}onValidateConfirm(e){const{data:t}=e.detail;this.addLoading();const i=new URL(t.returnUrl);i.searchParams.append("origin",window.location.href),this.form.formTheme&&this.form.formTheme.updateFormHash();("setup"===t.type?this.stripe.confirmSetup:this.stripe.confirmPayment)({elements:this.elements,clientSecret:t.clientSecret,redirect:"if_required",confirmParams:{return_url:i.toString()}}).then((e=>{if(this.removeError(),e.error)return this.removeLoading(),this.addError(e.error.message);this.updateInputs("stripeSubscriptionId",t.subscriptionId),this.updateInputs("stripePaymentIntentId",e.paymentIntent.id),this.processResubmit()}))}hasDynamicValue(e){return(this.initialPaymentInformation[e]??null).toString().includes("{field:")??!1}hasDynamicValues(){return this.hasDynamicValue("amount")||this.hasDynamicValue("currency")}checkDynamicValues(){const t=this.initialPaymentInformation?.amount??null,i=this.initialPaymentInformation?.currency??null,r=this.getFieldValue(t,"number"),s=this.getFieldValue(i),n=this.getFieldLabel(t),o=this.getFieldLabel(i);if(this.hasDynamicValue("amount")){if(!r)return this.showPlaceholder((0,e.t)("Provide a value for “{label}” to proceed.",{label:n}),"error"),!1;this.paymentInformation.amount=100*r}if(this.hasDynamicValue("currency")){if(!s)return this.showPlaceholder((0,e.t)("Provide a value for “{label}” to proceed.",{label:o}),"error"),!1;this.paymentInformation.currency=s.toLowerCase()}return!0}handleDynamicValues(){return!this.hasDynamicValues()||(this.form.addEventListener(this.$form,this.eventKey("input","stripe"),(0,e.Ds)((e=>{const i=e.target.name,r=this.initialPaymentInformation?.amount??null,s=this.initialPaymentInformation?.currency??null;i!==(0,t.Ts)(r)&&i!==(0,t.Ts)(s)||this.checkDynamicValues()&&(this.hidePlaceholder(),this.elements?this.elements.update(this.paymentInformation):this.renderStripe())}),600)),this.checkDynamicValues())}isSubscription(){return"subscription"===this.paymentType}addLoading(){this.form.formTheme&&this.form.formTheme.addLoading()}removeLoading(){this.form.formTheme&&this.form.formTheme.removeLoading()}onAfterSubmit(e){this.paymentElement&&this.paymentElement.clear(),this.updateInputs("stripePaymentIntentId",""),this.updateInputs("stripeSubscriptionId","")}}window.FormieStripe=l}()}();