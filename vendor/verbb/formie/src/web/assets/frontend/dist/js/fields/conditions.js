!function(){"use strict";const t=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e||(e=Math.random().toString(36).substr(2,5)),`${t}.${e}`};window.FormieConditions=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$form=t.$form,this.form=this.$form.form,this.conditionsStore=new WeakMap,this.initFieldConditions(this.$form),this.form.registerEvent("repeater:initRow",(t=>{this.initFieldConditions(t.$row)}))}initFieldConditions(e){e.querySelectorAll("[data-field-conditions]").forEach((e=>{const i=this.getFieldConditions(e),o=e.getAttribute("data-field-type");("group"===o||"repeater"===o)&&(i.nestedFieldConditions=e.querySelectorAll("[data-field-conditions]")),this.conditionsStore.set(e,i),this.form.addEventListener(e,t("onFormieEvaluateConditions"),this.evaluateConditions.bind(this)),e.dispatchEvent(new CustomEvent("onFormieEvaluateConditions",{bubbles:!0,detail:{conditions:this,init:!0}}))})),this.form.formTheme&&this.form.formTheme.updateFormHash()}getFieldConditions(e){const i=this.parseJsonConditions(e);if(!i||!i.conditions.length)return;const o=[];return i.conditions.forEach((i=>{let n=this.$form.querySelectorAll(`[name="${i.field}"]`);const s=this.$form.querySelectorAll(`[name="${i.field}[]"]`);if(s.length&&(n=s),(!n||!n.length)&&i.field.includes("__ROW__")){const t=i.field.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/__ROW__/g,"\\d+");n=this.querySelectorAllRegex(new RegExp(t),"name")}n&&n.length&&(i.$targets=n,o.push(i),n.forEach((o=>{const n=this.getEventType(o);if("visible"===i.condition||"hidden"===i.condition){new IntersectionObserver((t=>{const i=0!=t[0].intersectionRatio;e.dispatchEvent(new CustomEvent("onFormieEvaluateConditions",{bubbles:!0,detail:{conditions:this,isVisible:i}}))}),{root:this.$form}).observe(o)}else this.form.addEventListener(o,t(n),(()=>e.dispatchEvent(new CustomEvent("onFormieEvaluateConditions",{bubbles:!0,detail:{conditions:this}}))))})))})),{showRule:i.showRule,conditionRule:i.conditionRule,isNested:i.isNested||!1,conditions:o}}evaluateConditions(t){const e=t.target,i=!!t.detail&&t.detail.init,o=this.conditionsStore.get(e);if(!o)return;const{showRule:n,conditionRule:s,conditions:r,isNested:l,nestedFieldConditions:a}=o,d={};if(l){const t=e.closest('[data-field-type="group"], [data-field-type="repeater"]');if(t&&t.conditionallyHidden)return}r.forEach(((e,i)=>{const{condition:o,value:n,$targets:s,field:r}=e;s.forEach((e=>{let s=!1;const l={},a=e.tagName.toLowerCase(),c=e.getAttribute("type")?e.getAttribute("type").toLowerCase():"",u=`${r}_${i}`;d[u]||(d[u]=[]),"date"===c&&(l.isDate=!0);const h=null==n?"":String(n);if(t.detail&&void 0!==t.detail.isVisible&&(l.visibility=t.detail.isVisible),"agree"===e.getAttribute("data-fui-input-type")){if("hidden"===c)return;s=this.testCondition(o,"0"!=h,e.checked),d[u].push(s)}else"checkbox"===c||"radio"===c?(s=this.testCondition(o,h,e.value)&&e.checked,d[u].push(s)):"select"===a&&e.hasAttribute("multiple")?Array.from(e.options).forEach((t=>{s=this.testCondition(o,h,t.value)&&t.selected,d[u].push(s)})):(s=this.testCondition(o,h,e.value,l),d[u].push(s))}))}));const c=[];Object.values(d).forEach((t=>{c.push(t.includes(!0))}));let u=!1;c.length&&(u="all"===s?c.every((t=>!0===t)):c.includes(!0)),u&&"show"!==n||!u&&"show"===n?(e.conditionallyHidden=!0,e.setAttribute("data-conditionally-hidden",!0),e.querySelectorAll("input, textarea, select").forEach((t=>{t.setAttribute("disabled",!0)}))):(e.conditionallyHidden=!1,e.removeAttribute("data-conditionally-hidden"),e.querySelectorAll("input, textarea, select").forEach((t=>{t.removeAttribute("disabled")}))),this.updateRowVisibility(e),e.dispatchEvent(new CustomEvent("onAfterFormieEvaluateConditions",{bubbles:!0,detail:{conditions:this,init:i}})),a&&!i&&a.forEach((t=>{this.evaluateConditions({target:t})}))}parseJsonConditions(t){const e=t.getAttribute("data-field-conditions");if(e)try{return JSON.parse(e)}catch(t){console.error(`Unable to parse JSON conditions: ${t}`)}return!1}getEventType(t){const e=t.closest("[data-field-type]"),i=(e?.getAttribute("data-field-type"),t.tagName.toLowerCase()),o=t.getAttribute("type")?t.getAttribute("type").toLowerCase():"";return"file"===o||"radio"===o||"checkbox"===o||"select"===i||"date"===o?"change":"input"}testCondition(t,e,i){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=!1;o.isDate&&(e=new Date(e).valueOf(),i=new Date(i).valueOf());const s=t=>null==t||("string"==typeof t&&""===t.trim()||(!(!Array.isArray(t)||0!==t.length)||"object"==typeof t&&!Array.isArray(t)&&0===Object.keys(t).length));return"="===t?n=e===i:"!="===t?n=e!==i:">"===t?n=parseFloat(i,10)>parseFloat(e,10):"<"===t?n=parseFloat(i,10)<parseFloat(e,10):"contains"===t?n=i?.includes?.(e):"startsWith"===t?n=i?.startsWith?.(e):"endsWith"===t?n=i?.endsWith?.(e):"empty"===t?n=s(i):"notEmpty"===t?n=!s(i):"visible"===t?n=!0===o.visibility:"hidden"===t&&(n=!1===o.visibility),n}querySelectorAllRegex(t,e){const i=[];for(const o of this.$form.querySelectorAll(`[${e}]`))t.test(o.getAttribute(e))&&i.push(o);return i}updateRowVisibility(t){const e=t.closest("[data-fui-field-count]");if(e){const t=e.querySelectorAll("[data-field-handle]:not([data-conditionally-hidden])"),i=Array.from(t).filter((t=>t.closest("[data-fui-field-count]")===e));e.setAttribute("data-fui-field-count",i.length),e.classList.contains("fui-row")&&(0===i.length?e.classList.add("fui-row-empty"):e.classList.remove("fui-row-empty"))}}}}();