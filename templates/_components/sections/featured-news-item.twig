
{% set article = craft.entries()
    .section('newsSection')
    .type('newsArticle')
    .featuredArticle(true)
    .orderBy('postDate desc')
    .with([
        ['articleImage', {
            withTransforms: [
                { width: 600, height: 400, mode: 'crop', format: 'webp', quality: 85 },
                { width: 1200, height: 800, mode: 'crop', format: 'webp', quality: 85 }
            ]
        }],
        'author'
    ])
    .one() %}

{# Fallback: get the most recent article if no featured article exists #}
{% if not article %}
    {% set article = craft.entries()
        .section('newsSection')
        .type('newsArticle')
        .orderBy('postDate desc')
        .with([
            ['articleImage', {
                withTransforms: [
                    { width: 600, height: 400, mode: 'crop', format: 'webp', quality: 85 },
                    { width: 1200, height: 800, mode: 'crop', format: 'webp', quality: 85 }
                ]
            }],
            'author'
        ])
        .one() %}
{% endif %}

{% if article %}
    {# Generate excerpt from articleText #}
    {% set articleContent = article.articleText %}
    {% set excerpt = articleContent|striptags|slice(0, 150) ~ '...' %}
    
    <div class="featured-news" data-modal-target="news-modal-{{ article.id }}">
        <div class="featured-image">
            {% if article.articleImage|length %}
                {% set image = article.articleImage.one() %}
                <img src="{{ image.getUrl() }}" alt="{{ article.title }}">
            {% else %}
                <img src="/images/new/news/default.webp" alt="{{ article.title }}">
            {% endif %}
            <div class="featured-overlay">
                <span class="featured-tag">Featured</span>
            </div>
        </div>
        <div class="featured-content">
            <div class="news-meta">
                <span class="date"><i class="far fa-calendar-alt"></i> {{ article.postDate|date('F j, Y') }}</span>
                {% if article.author %}
                    <span class="author"><i class="far fa-user"></i> {{ article.author.fullName ?? article.author.username }}</span>
                {% endif %}
            </div>
            <h2>{{ article.title }}</h2>
            <p>{{ excerpt }}</p>
            <a href="#" class="btn primary" data-modal-target="news-modal-{{ article.id }}">
                <i class="fas fa-arrow-right btn-icon"></i>
                Read More
            </a>
        </div>
    </div>

    {# Modal for the featured article #}
    <div id="news-modal-{{ article.id }}" class="modal-overlay news-article-modal" style="display: none;" data-article-id="{{ article.id }}">
        <div class="modal-content modal-large">
            <button class="modal-close" aria-label="Close modal">&times;</button>
            <div class="modal-body">
                <div class="news-article-header">
                    {% if article.articleImage|length %}
                        {% set image = article.articleImage.one() %}
                        <img src="{{ image.getUrl() }}" alt="{{ article.title }}" class="news-modal-image" data-image-url="{{ image.getUrl() }}">
                    {% endif %}
                    <div class="article-meta">
                        <h1 class="news-modal-title">{{ article.title }}</h1>
                        <div class="news-meta">
                            <span class="news-modal-date">
                                <i class="far fa-calendar"></i>
                                {{ article.postDate|date('F j, Y') }}
                            </span>
                            {% if article.author %}
                                <span class="news-modal-author">
                                    <i class="far fa-user"></i>
                                    {{ article.author.fullName ?? article.author.username }}
                                </span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="news-content-wrapper">
                    <div class="news-content-header">
                        <h1 class="news-modal-title">{{ article.title }}</h1>
                        <div class="news-meta">
                            <span class="news-modal-date">
                                <i class="far fa-calendar"></i>
                                {{ article.postDate|date('F j, Y') }}
                            </span>
                            {% if article.author %}
                                <span class="news-modal-author">
                                    <i class="far fa-user"></i>
                                    {{ article.author.fullName ?? article.author.username }}
                                </span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="news-modal-content">
                        {{ article.articleText|raw }}
                    </div>
                    <div class="modal-actions">
                        <div class="social-share">
                            <span>Share this article:</span>
                            <a href="https://www.facebook.com/sharer/sharer.php?u={{ craft.app.request.absoluteUrl|url_encode }}" 
                               class="share-btn facebook" 
                               title="Share on Facebook"
                               target="_blank"
                               rel="noopener">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            <a href="https://twitter.com/intent/tweet?url={{ craft.app.request.absoluteUrl|url_encode }}&text={{ article.title|url_encode }}" 
                               class="share-btn twitter" 
                               title="Share on Twitter"
                               target="_blank"
                               rel="noopener">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ craft.app.request.absoluteUrl|url_encode }}" 
                               class="share-btn linkedin" 
                               title="Share on LinkedIn"
                               target="_blank"
                               rel="noopener">
                                <i class="fab fa-linkedin-in"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endif %}
