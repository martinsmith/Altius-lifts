{% import '_components/macros/ui-components.twig' as ui %}

{% set socialImages = entry.socialSection.socialImages
    .eagerly()
    .withTransforms([
        { width: 300, height: 300, mode: 'crop', format: 'webp', quality: 85 },
        { width: 600, height: 600, mode: 'crop', format: 'webp', quality: 85 }
    ])
    .all() %}
{% set sectionData = {
  title: entry.socialSection.sectionTitle,
  subtitle: entry.socialSection.sectionSubText,
  ctaText: entry.socialSection.linkToSocial.label ?? null,
  ctaLink: entry.socialSection.linkToSocial ?? null,
  handle: 'instagram-feed'
} %}

{# Cache the instagram feed for 1 hour #}
{% cache using key (entry.id ~ '-instagram-feed') for 1 hour %}
<section class="instagram-feed section-base section-base--default">
    <div class="container">
        {% if sectionData.title or sectionData.subtitle %}
            <div class="section-header section-header--center">
                {% if sectionData.title %}
                    <h2>{{ sectionData.title }}</h2>
                {% endif %}
                {% if sectionData.subtitle %}
                    <p>{{ sectionData.subtitle }}</p>
                {% endif %}
            </div>
        {% endif %}

        {% if socialImages|length %}
            <div class="instagram-grid responsive-grid adaptive-grid">
                {% for image in socialImages %}
                    <div class="ins`tagram-item">
                        <a href="{{ entry.socialSection.linkToSocial ?? '#' }}"
                           target="_blank"
                           rel="noopener noreferrer"
                           aria-label="View on social media">
                            {{ ui.image(image, {
                                transforms: [
                                    { width: 300, height: 300, mode: 'crop' },
                                    { width: 600, height: 600, mode: 'crop' }
                                ],
                                sizes: '(max-width: 768px) 50vw, (max-width: 1200px) 33vw, 25vw',
                                alt: image.alt ?? 'Social media post',
                                class: 'instagram-image'
                            }) }}
                            <div class="instagram-overlay">
                                <i class="fab {{ entry.socialSection.overlayIcon ?? 'fa-instagram' }}"></i>
                            </div>
                        </a>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {% if sectionData.ctaText and sectionData.ctaLink %}
            <div class="section-cta">
                <a href="{{ sectionData.ctaLink }}" class="btn secondary">
                    {% if entry.socialSection.buttonIcon %}
                        <i class="fab {{ entry.socialSection.buttonIcon }} btn-icon"></i>
                    {% endif %}
                    {{ sectionData.ctaText }}
                </a>
            </div>
        {% endif %}
    </div>
</section>
{% endcache %}
